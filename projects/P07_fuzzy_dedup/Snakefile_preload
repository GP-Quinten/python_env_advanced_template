# Rule to load registry dataset from S3 and save as JSON
rule R01_load_registry_dataset:
    input:
        script="src/scripts/S01_load_registry_dataset.py"
    output:
        "data/R01_load_registry_dataset/registry_dataset.json"
    shell:
        """
        python {input.script} --output-dir data/R01_load_registry_dataset
        """


rule R01_preload_embeddings__annotated_ds:
    input:
        script="src/scripts/S01_load_annotated_ds_embeddings.py"
    params:
        s3_input_embeddings="registry_data_catalog_experiments/P05_refine_dedup/raw_registry_names_embeddings.parquet",
        output_path="data/R01_preload_embeddings__annotated_ds/embeddings.parquet"
    output:
        "data/R01_preload_embeddings__annotated_ds/embeddings.parquet"
    shell:
        r"""
        python {input.script} \
          --s3_input_embeddings {params.s3_input_embeddings} \
          --output_path {params.output_path}
        """

rule R01_preload_EMA_embeddings__annotated_ds:
    input:
        script="src/scripts/S01_load_annotated_ds_embeddings.py"
    params:
        s3_input_embeddings="registry_data_catalog_experiments/P05_refine_dedup/ema_registry_names_embeddings.parquet",
        output_path="data/R01_preload_embeddings__annotated_ds/ema_embeddings.parquet"
    output:
        "data/R01_preload_embeddings__annotated_ds/ema_embeddings.parquet"
    shell:
        r"""
        python {input.script} \
          --s3_input_embeddings {params.s3_input_embeddings} \
          --output_path {params.output_path}
        """


rule R01_preload_medical_conditions__annotated_ds:
    input:
        script="src/scripts/S01_load_annotated_ds_medical_conditions.py"
    params:
        s3_input_registry_medc_jsonl_template="registry_data_catalog_experiments/P04_official_reg_db_creation/datasets_versions/update_medical_condition/registry_data/1.jsonl",
        output_path="data/R01_preload_medical_conditions__annotated_ds/medc.parquet"
    output:
        "data/R01_preload_medical_conditions__annotated_ds/medc.parquet"
    shell:
        r"""
        python {input.script} \
          --s3_input_registry_medc_jsonl_template {params.s3_input_registry_medc_jsonl_template} \
          --output_path {params.output_path}
        """

rule R01_preload_geographical_areas__annotated_ds:
    input:
        script="src/scripts/S01_load_annotated_ds_geographical_areas.py"
    params:
        # NOT generated yet -> to later modify this path
        s3_input_registry_geoarea_jsonl_template="registry_data_catalog_experiments/P04_official_reg_db_creation/datasets_versions/update_geographical_area/registry_data/1.jsonl",
        output_path="data/R01_preload_geographical_areas__annotated_ds/geo_area.parquet"
    output:
        "data/R01_preload_geographical_areas__annotated_ds/geo_area.parquet"
    shell:
        r"""
        python {input.script} \
          --s3_input_registry_geoarea_jsonl_template {params.s3_input_registry_geoarea_jsonl_template} \
          --output_path {params.output_path}
        """